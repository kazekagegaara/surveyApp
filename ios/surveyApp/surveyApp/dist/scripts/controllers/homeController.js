!function(){"use strict";angular.module("surveyApp").controller("homeController",["$scope","$location","serviceCall","activeData",function(e,s,r,t){e.title="Home",e.nextDueSurveyID="",e.controllerInit=function(){if(localStorage.surveyAppPin)if(localStorage.surveyAppServerSettings){$("#startSurvey").removeClass("disabled");var s=localStorage.surveyAppPin,t='{"userPIN":'+s+"}",o=new r("getSurveyID","GET");o.call(t,e.surveyIDsuccess,e.serviceError,"json/getSurveyID.json")}else e.surveyMessage="You don't have your server settings setup.";else e.surveyMessage=localStorage.surveyAppServerSettings?"You don't have your PIN setup.":"You don't have your PIN and server settings setup."},e.surveyIDsuccess=function(s){var r=[];if("Success"==s.message){angular.forEach(s.surveys,function(e){console.log(e.nextDueAt),r.push(e.nextDueAt)}),r.sort(function(e,s){return Date.parse(e)-Date.parse(s)}),console.log(r);var o=r[0];angular.forEach(s.surveys,function(s){s.nextDueAt==o&&(e.nextDueSurveyID=s.surveyInstanceID)}),console.log(e.nextDueSurveyID),t.setSurveyID(e.nextDueSurveyID),e.surveyMessage="You have a survey due at "+o+". To begin survey, please click on the Start Survey button."}else"You have no active surveys"==s.message?e.surveyMessage="You have no surveys due. Please check in again later.":"Your PIN is not active"==s.message?e.surveyMessage="Your PIN is not active. Please contact the administrator.":"The PIN is invalid"==s.message?e.surveyMessage="Your PIN is not invalid. Please contact the administrator.":"Unexpected Error"==s.message&&(e.surveyMessage="Unexpected Error. Please contact the administrator.")},e.serviceError=function(e){console.log(e),alert("Error! Please try again later.")},e.getSurvey=function(){console.log(e.nextDueSurveyID);var s='{"surveyID":'+e.nextDueSurveyID+"}";console.log(s);var t=new r("getSurveyID","GET");t.call(s,e.getSurveySuccess,e.serviceError,"json/getSurvey.json")},e.getSurveySuccess=function(s){console.log(s),t.setSurveyQuestions(s.questions),e.changePage("/survey")},e.changePage=function(e){s.path(e)},Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),s=(this.getMonth()+1).toString(),r=this.getDate().toString();return e+"-"+(s[1]?s:"0"+s[0])+"-"+(r[1]?r:"0"+r[0])},e.controllerInit()}])}();